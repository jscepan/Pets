<!-- Sign in form -->
<div class="auth-form flex flex-col">
  <form
    autocomplete="off"
    name="signUpForm"
    [formGroup]="signUpForm"
    novalidate
    *ngIf="signUpForm"
  >

    <div
      class="auth-message-error auth-mb-36"
      *ngIf="passwordsDifferent"
    >
      <mat-icon [svgIcon]="'heroicons_solid:exclamation-circle'"></mat-icon>
      <span>
        Passwords don't match. Please check and try again.
      </span>
    </div>

    <div
      class="auth-message-error auth-mb-36"
      *ngIf="!tokenValid"
    >
      <mat-icon [svgIcon]="'heroicons_solid:exclamation-circle'"></mat-icon>
      <span>
        Your password recovery token has expired. Please return to the sign in page.
      </span>
    </div>

    <div class="auth-form-title">
      <span>Complete your account creation</span>
    </div>

    <ng-container *ngIf="tokenValid">

      <div class="auth-input-field flex flex-row">
        <mat-form-field
          appearance="outline"
          [hideRequiredMarker]="true"
        >
          <mat-label>First name</mat-label>
          <input
            matInput
            type="text"
            formControlName="firstName"
            required
          >
          <mat-error>
            First name is required
          </mat-error>
        </mat-form-field>
      </div>

      <div class="auth-input-field flex flex-row">
        <mat-form-field
          appearance="outline"
          [hideRequiredMarker]="true"
        >
          <mat-label>Last name</mat-label>
          <input
            matInput
            type="text"
            formControlName="lastName"
            required
          >
          <mat-error>
            Last name is required
          </mat-error>
        </mat-form-field>
      </div>

      <div class="auth-input-field flex flex-row">
        <mat-form-field
          appearance="outline"
          [hideRequiredMarker]="true"
        >
          <mat-label>Email address</mat-label>
          <input
            matInput
            type="text"
            formControlName="email"
            required
          >
          <mat-error>
            Valid email is required
          </mat-error>
        </mat-form-field>
      </div>

      <div class="auth-input-field flex flex-row">
        <mat-form-field appearance="outline">
          <mat-label>Company name</mat-label>
          <input
            name="customerName"
            matInput
            type="text"
            formControlName="customerName"
          >
        </mat-form-field>
      </div>

      <div
        class="auth-password-message-error auth-mb-36"
        *ngIf="!signUpForm?.get('password')?.pristine && !isPasswordValid()"
      >

        <div class="auth-password-message-error-false">
          <span>
            New password must have at least
          </span>
        </div>

        <div
          class="auth-password-message-error-true"
          *ngIf="hasEightCharacters"
        >
          <mat-icon [svgIcon]="'heroicons_outline:check-circle'"></mat-icon>
          <span>
            8 characters
          </span>
        </div>

        <div
          class="auth-password-message-error-false"
          *ngIf="!hasEightCharacters"
        >
          <mat-icon [svgIcon]="'heroicons_outline:minus-circle'"></mat-icon>
          <span>
            8 characters
          </span>
        </div>

        <div
          class="auth-password-message-error-true"
          *ngIf="hasUpperCase"
        >
          <mat-icon [svgIcon]="'heroicons_outline:check-circle'"></mat-icon>
          <span>
            One uppercase
          </span>
        </div>

        <div
          class="auth-password-message-error-false"
          *ngIf="!hasUpperCase"
        >
          <mat-icon [svgIcon]="'heroicons_outline:minus-circle'"></mat-icon>
          <span>
            One uppercase
          </span>
        </div>

        <div
          class="auth-password-message-error-true"
          *ngIf="hasLowerCase"
        >
          <mat-icon [svgIcon]="'heroicons_outline:check-circle'"></mat-icon>
          <span>
            One lowercase
          </span>
        </div>

        <div
          class="auth-password-message-error-false"
          *ngIf="!hasLowerCase"
        >
          <mat-icon [svgIcon]="'heroicons_outline:minus-circle'"></mat-icon>
          <span>
            One lowercase
          </span>
        </div>

        <div
          class="auth-password-message-error-true"
          *ngIf="hasNumeric"
        >
          <mat-icon [svgIcon]="'heroicons_outline:check-circle'"></mat-icon>
          <span>
            One number
          </span>
        </div>

        <div
          class="auth-password-message-error-false"
          *ngIf="!hasNumeric"
        >
          <mat-icon [svgIcon]="'heroicons_outline:minus-circle'"></mat-icon>
          <span>
            One number
          </span>
        </div>
      </div>

      <mat-form-field
        appearance="outline"
        [hideRequiredMarker]="true"
        class="auth-input-field"
      >
        <mat-label>New password</mat-label>
        <input
          name="password"
          type="password"
          matInput
          formControlName="password"
          required
          #passwordField
        >
        <button
          mat-icon-button
          type="button"
          (click)="passwordField.type === 'password' ? passwordField.type = 'text' : passwordField.type = 'password'"
          matSuffix
        >
          <mat-icon
            [svgIcon]="'heroicons_outline:eye-off'"
            *ngIf="passwordField.type === 'password'"
            class="auth-password-visibility"
          >
          </mat-icon>
          <mat-icon
            [svgIcon]="'heroicons_outline:eye'"
            *ngIf="passwordField.type === 'text'"
            class="auth-password-visibility"
          >
          </mat-icon>
        </button>
        <mat-error>
          Password is required
        </mat-error>
      </mat-form-field>

      <mat-form-field
        appearance="outline"
        [hideRequiredMarker]="true"
        class="auth-input-field"
      >
        <mat-label>Confirm new password</mat-label>
        <input
          name="passwordConfirm"
          type="password"
          matInput
          formControlName="passwordConfirm"
          required
          #confirmPasswordField
        >
        <button
          mat-icon-button
          type="button"
          (click)="confirmPasswordField.type === 'password' ? confirmPasswordField.type = 'text' : confirmPasswordField.type = 'password'"
          matSuffix
        >
          <mat-icon
            [svgIcon]="'heroicons_outline:eye-off'"
            *ngIf="confirmPasswordField.type === 'password'"
            class="auth-password-visibility"
          >
          </mat-icon>
          <mat-icon
            [svgIcon]="'heroicons_outline:eye'"
            *ngIf="confirmPasswordField.type === 'text'"
            class="auth-password-visibility"
          >
          </mat-icon>
        </button>
        <mat-error>
          Passwords don't match
        </mat-error>
      </mat-form-field>

      <div class="auth-small-text auth-mb-42 flex flex-col items-center">
        <span>By signing in, I agree to the <a
            class="auth-under-text"
            [href]="'https://material-exchange.com/dsp-terms-and-conditions/'"
            target="_blank"
            rel="noopener noreferrer"
          >Terms and Conditions</a>
          and <a
            class="auth-under-text"
            [href]="'https://material-exchange.com/legal/data-processing-agreement/'"
            target="_blank"
            rel="noopener noreferrer"
          >Data Processing Agreement</a>,
          as well as confirm that I have read the <a
            class="auth-under-text"
            [href]="'https://material-exchange.com/legal/data-protection-notice/'"
            target="_blank"
            rel="noopener noreferrer"
          >Data Protection Notice</a>.
        </span>
      </div>

      <button
        mat-flat-button
        color="primary"
        class="auth-submit-button"
        aria-label="LOG IN"
        [disabled]="signUpForm.get('passwordConfirm')?.value === ''
                              || signUpForm.get('passwordConfirm')?.value === null
                              || !isPasswordValid()"
        (click)="createAccount()"
      >
        Submit
      </button>
    </ng-container>

    <div class="flex flex-col justify-center items-center">
      <a
        class="auth-small-text auth-under-text"
        [routerLink]="'/sign-in'"
      >
        Back to Sign in
      </a>
    </div>
  </form>
</div>
